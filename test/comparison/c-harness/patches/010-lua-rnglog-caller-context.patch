diff --git a/src/nhlua.c b/src/nhlua.c
index 96970f73c..211f2f965 100644
--- a/src/nhlua.c
+++ b/src/nhlua.c
@@ -67,6 +67,8 @@ staticfn int nhl_ing_suffix(lua_State *);
 staticfn int nhl_an(lua_State *);
 staticfn int nhl_rn2(lua_State *);
 staticfn int nhl_random(lua_State *);
+staticfn boolean nhl_lua_rnglog_ctx_enabled(void);
+staticfn void nhl_rnglog_set_lua_caller(lua_State *, const char *);
 staticfn int nhl_level_difficulty(lua_State *);
 staticfn int nhl_is_genocided(lua_State *);
 staticfn int nhl_get_debug_themerm_name(lua_State *);
@@ -920,14 +922,59 @@ nhl_an(lua_State *L)
     return 1;
 }
 
+/* rn2(10) */
+staticfn boolean
+nhl_lua_rnglog_ctx_enabled(void)
+{
+    static int enabled = -1;
+    const char *env;
+
+    if (enabled >= 0)
+        return enabled ? TRUE : FALSE;
+
+    env = getenv("NETHACK_LUA_RNGLOG_CTX");
+    enabled = (env && *env && strcmp(env, "0")) ? 1 : 0;
+    return enabled ? TRUE : FALSE;
+}
+
+staticfn void
+nhl_rnglog_set_lua_caller(lua_State *L, const char *fallback)
+{
+    static char rnglog_srcbuf[BUFSZ];
+    static char rnglog_namebuf[BUFSZ];
+    lua_Debug ar;
+    const char *src = "lua";
+    int line = 0;
+    const char *name = fallback;
+
+    if (!nhl_lua_rnglog_ctx_enabled())
+        return;
+
+    if (lua_getstack(L, 1, &ar) && lua_getinfo(L, "nSl", &ar)) {
+        if (ar.short_src && *ar.short_src) {
+            Snprintf(rnglog_srcbuf, sizeof rnglog_srcbuf, "%s", ar.short_src);
+            src = rnglog_srcbuf;
+        }
+        line = ar.currentline;
+        if (ar.name && *ar.name) {
+            Snprintf(rnglog_namebuf, sizeof rnglog_namebuf, "%s", ar.name);
+            name = rnglog_namebuf;
+        }
+    }
+    rng_log_set_caller(src, line, name);
+}
+
 /* rn2(10) */
 staticfn int
 nhl_rn2(lua_State *L)
 {
     int argc = lua_gettop(L);
 
-    if (argc == 1)
-        lua_pushinteger(L, rn2((int) luaL_checkinteger(L, 1)));
+    if (argc == 1) {
+        int range = (int) luaL_checkinteger(L, 1);
+        nhl_rnglog_set_lua_caller(L, "nh.rn2");
+        lua_pushinteger(L, (rn2)(range));
+    }
     else
         nhl_error(L, "Wrong args");
 
@@ -941,11 +988,16 @@ nhl_random(lua_State *L)
 {
     int argc = lua_gettop(L);
 
-    if (argc == 1)
-        lua_pushinteger(L, rn2((int) luaL_checkinteger(L, 1)));
-    else if (argc == 2)
-        lua_pushinteger(L, luaL_checkinteger(L, 1)
-                               + rn2((int) luaL_checkinteger(L, 2)));
+    if (argc == 1) {
+        int range = (int) luaL_checkinteger(L, 1);
+        nhl_rnglog_set_lua_caller(L, "nh.random");
+        lua_pushinteger(L, (rn2)(range));
+    } else if (argc == 2) {
+        int base = (int) luaL_checkinteger(L, 1);
+        int range = (int) luaL_checkinteger(L, 2);
+        nhl_rnglog_set_lua_caller(L, "nh.random");
+        lua_pushinteger(L, base + (rn2)(range));
+    }
     else
         nhl_error(L, "Wrong args");
 
